<!DOCTYPE html>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#DDB88C">
<link rel="icon" href="icons/icon-192.png">
<meta charset="UTF-8">
<html lang="en">
<head>
	<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
	<title>Journal</title>
	<style>
		@font-face {
			font-family: "FangZheng";
			src: url('./fangzheng.TTF') format('truetype');
			font-weight: normal;
			font-style: normal;
		}

		/* 基本样式 */

		/* 背景 */
		html, body {
			margin: 0;
			padding: 0;
			height: 100%;
			background-image: url('./bg.jpg');
			background-size: cover;
			background-position: center;
			background-repeat: no-repeat;
			overflow: hidden; /* 如果你用 scrollCanvas 容器滚动 则禁止背景滚动*/
		}
		
		/* 滚动容器 */
		#scrollCanvas {
			position: relative;
			min-width: 100vw;
			min-height: 100vh;
			overflow: auto;        /* 双向滚动 */
			width: max-content;    /* 根据内容宽度撑开，触发横向滚动 */
			height: max-content;   /* 根据内容高度撑开，触发纵向滚动 */
			-webkit-overflow-scrolling: touch;
			box-sizing: border-box;
			display: grid;
			grid-template-columns: 1fr auto; /* 左侧占满剩余空间，右侧自适应 */
		}
		
		/* 时间区域 */
		#time{
			position: absolute;
			top: 8vh;
			width: max-content;
			right: 5vw;
			font-size: 15rem;
			color: rgba(84, 13, 13, 0.8);
			cursor: pointer;
			display: flex;
			transform: translateX(0);
			font-family: "FangZheng", serif;
		}
		#time p {
			position: relative;
			margin: 0;
		}
		#time .sep {
			position: relative;
			transform: translateY(-1.5rem);
		}

		/* 表格区域 */
		#table{
			position: absolute; 
			width: 60vw;
			top: 25vh;
			right: 5vw ;
			box-sizing: border-box;
			-webkit-overflow-scrolling: touch;
    		transform: translateX(calc(100% - 55vw)); /* 然后移动到右边 */
		}
		
		/* 表头 */
		#caption{
			position: relative;
			display: flex;
			width:100%;
		}
		/* 月 */
		#caption > .monthIndex{
			position: relative;
			width: 10vw;
			text-align: center;
			box-sizing: border-box;
			font-family: "FangZheng", serif;
		}
		#caption > .monthIndex>p{
			position: relative;
			margin: 0px 0px 0px 0px;
			display: inline;
  			vertical-align: baseline;
						font-family: "FangZheng", serif;
		}
		#caption > .monthIndex>p:nth-child(1){
			color: rgba(84, 13, 13, 0.8);
			font-size: 6rem;
			line-height: 6rem;
						font-family: "FangZheng", serif;
		}
		#caption > .monthIndex>p:nth-child(2){
			margin-left: 0.5rem;
			color: rgba(84, 13, 13, 0.8);
			font-weight: bold;
			font-size: 3rem;
			line-height: 3rem;
						font-family: "FangZheng", serif;
		}
		#caption > .weekIndex{
			position: relative;
			width: 10vh;
			text-align: center;
			font-weight: bold;
			color: rgba(84, 13, 13, 0.6);
			display: flex;
			flex-direction: column;
			overflow-y: auto; /* 允许垂直滚动 */
			justify-content: flex-end;		
			font-family: "FangZheng", serif;
		}
		#caption > .weekIndex p {
			margin: 0;
			width: 100%;
			text-align: center;
			margin-bottom: 0.3rem;
			font-size: 2rem;
			line-height: 2rem;
			font-family: "FangZheng", serif;
		}

		
		/* 列元素 */
		.row {
			position: relative;
			display: flex;
			width: max-content;
		}
		
		/* 保持 info 可滚动 */
		#info {
			position: relative;
			border: 1px solid rgba(84, 13, 13, 0.9);
			border-right: none;
			width: 10vw;
			height: auto;
			max-height: 60vh;
			box-sizing: border-box;
			overflow: hidden;
			
		}

		#info > .letter{
			position: relative;
			top: 1%;
			width: 100%;
			color: rgba(84, 13, 13, 0.9);
			margin: 0.5rem;
			font-size: 2rem;
			text-indent: 2rem;
			z-index: 1;
			font-family: "FangZheng", serif;
			
		}

		#dateGrid{
			position: relative;
			display: flex;
			flex-direction: column;
			overflow: auto;
			width: max-content;
			overflow: visible;
		}
		.dateLine{
			position: relative;
			display: flex;
			flex-direction: row;
			width: max-content;
		}
		.dateBlock{
			position: relative;
			width: 10vh;
			height: 10vh;
			border: 1px solid rgba(84, 13, 13, 0.67);
			border-bottom: none;
			border-right: none;
			box-sizing: border-box;	
		}
		.dateLine:last-child .dateBlock {
			border-bottom: 1px solid rgba(84, 13, 13, 0.67);			
		}
		.dateBlock:last-child {
			border-right: 1px solid rgba(84, 13, 13, 0.67);			
		}
		.dateBlock > span:nth-child(1){
			position: absolute;
			top:2px;
			left:2px;
			color: rgba(84, 13, 13, 0.8);
			font-size: 2rem;			
		}
		.dateBlock > span:nth-child(2){
			position: absolute;
			top: 50%;
			width: 100%;
			text-align: center;
			padding: 4px;
			box-sizing: border-box;
			transform: translateY(-50%);
			color: rgba(84, 13, 13, 0.8);
			font-weight: bold;
			font-size: 1.0rem;
			word-break: break-all;			
		}



		/* 竖屏优化 */
		@media (orientation: portrait) {
			#time{
				font-size: 10rem;
				right: 5vw;
				top: 5vh;
			}
			#table{
				width: 90vw;
				top: 20vh;
				right: 5vw;
			}
			#caption > .monthIndex{
				width: 12vh;
			}
			#caption > .weekIndex{
				width: 8vh;
				font-size: 1.5rem;
			}
			.dateBlock{
				width: 12vh;
				height: 12vh;
			}
			#info,
			#caption > .monthIndex{
				width: 12vh;
				font-size: 1.5rem;
			}

		}

		/* 横屏优化 */
		/* @media (orientation: landscape) {
			#time{
				font-size: 15rem;
				right: 5vw;
				top: 8vh;
			}
			#table{
				width: 60vw;
				top: 25vh;
				right: 5vw;
			}
			#caption > .monthIndex{
				width: 15vh;
			}
			#caption > .weekIndex{
				width: 10vh;
				font-size: 2rem;
			}
			.dateBlock{
				width: 10vh;
				height: 10vh;
			}
		} */
	</style>
</head>
<body>

	<div id="scrollCanvas">
	<div id ="time"><p>19</p><span class="sep">:</span><p>00</p></div>
	<div id ="table">
		<div id = "caption">
			<div class = "monthIndex"><p>01</p><p>January</p></div>
			<div class = "weekIndex"><p>MON</p></div>
			<div class = "weekIndex"><p>TUE</p></div>
			<div class = "weekIndex"><p>WED</p></div>
			<div class = "weekIndex"><p>THU</p></div>
			<div class = "weekIndex"><p>FRI</p></div>
			<div class = "weekIndex"><p>SAT</p></div>
			<div class = "weekIndex"><p>SUN</p></div>
		</div>
		<div class="row">
			<div id = "info">
				<div class = "letter">
				</div>
			</div>
			<div id = "dateGrid">
				<div class = "dateLine">
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
				</div>
				<div class = "dateLine">
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
				</div>
				<div class = "dateLine">
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
				</div>
				<div class = "dateLine">
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
				</div>
				<div class = "dateLine">
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
				</div>
				<div class = "dateLine">
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
					<div class = "dateBlock"><span></span><span></span>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').then(()=>console.log('SW registered'));
}
</script>

<script>
	document.documentElement.style.fontSize = window.innerHeight / 100 + 'px'
	//push random letter
	{
		var sentence = [];
		sentence.push("每个人都有属于自己的一片森林，也许我们从来不曾去过，但它一直在那里，总会在那里。迷失的人迷失了，相逢的人会再相逢。");
		sentence.push("不管全世界所有人怎么说，我都认为自己的感受才是正确的。无论别人怎么看，我绝不打乱自己的节奏。喜欢的事自然可以坚持，不喜欢怎么也长久不了。");
		sentence.push("我或许败北，或许迷失自己，或许哪里也抵达不了，或许我已失去一切，任凭怎么挣扎也只能徒呼奈何，或许我只是徒然掬一把废墟灰烬，唯我一人蒙在鼓里，或许这里没有任何人把赌注下在我身上。无所谓。有一点是明确的：至少我有值得等待有值得寻求的东西。");
		sentence.push("每天差不多都是相同的重复。昨天和前天颠倒顺序，也没有任何不便。我不时想，这叫什么人生啊！但也没有因此感觉光阴虚度。我仅仅是感到惊讶，惊讶于昨天与前天毫无区别，惊讶于自己被编排入这样的人生，惊讶于自己留下的足迹甚至还未及认清，就在转瞬间被风吹走，变得无影无踪。");
		sentence.push("世上存在着不能流泪的悲哀，这种悲哀无法向人解释，即使解释人家也不会理解。它永远一成不变，如无风夜晚的雪花静静沉积在心底。");
		sentence.push("要做一个不动声色的大人了。不准情绪化，不准偷偷想念，不准回头看。去过自己另外的生活。你要听话，不是所有鱼都会生活在同一片海里。我一直以为人是慢慢变老的，其实不是，人是一瞬间变老的。");
		sentence.push("我看见一只白色的鸟在漫天飘舞的雪花中朝南面飞去。鸟越过围墙，消失在南面大雪弥漫的空中。之后，剩下的惟有我踏雪的吱吱声");
		let randSent = Math.round(Math.random()* 6);
		document.getElementById("info").getElementsByClassName("letter")[0].innerText = sentence[randSent];
	}

	var monthIndex = document.getElementsByClassName("monthIndex");
	var dateLine = document.getElementsByClassName("dateLine");


	//push date
	var upDay = true;
	{
		let monthType = {
			1: 'JAN',
			2: 'FEB',
			3: 'MAR',
			4: 'APR',
			5: 'MAY',
			6: 'JUN',
			7: 'JUL',
			8: 'AUG',
			9: 'SEP',
			10: 'OCT',
			11: 'NOV',
			12: 'DEC'
		};

		function isLeapyear(year){
			if(year % 100){
				if(year%4){
					return false;
				}
				else return true;
			}
			else return true;
		}

		function pushDate(){
			var daySum;
			days = [];
			var date = new Date();
			var day = date.getDate();
			var month = date.getMonth() + 1;
			var year = date.getFullYear();
			var weekDay = date.getDay()? date.getDay() : 7;
			switch(month) {
				case 2:
					if(isLeapyear(year)){
						daySum = 29;
					}
					else daySum = 28;
					break;
				case 4:
				case 6:
				case 9:
				case 11:
					daySum = 30;
					break;
				default:
					daySum =31;
			}
			if (month < 10){
				month = "0" + month;
			}
			if(month != localStorage["journal_month"]){
				localStorage["journal_month"]  = month;
				for(var i = 1; i <=31; i++){
					localStorage["journal_" + i] = " ";
				}
			}
			//push the month
			monthIndex[0].childNodes[0].innerText = month;
			monthIndex[0].childNodes[1].innerText = monthType[parseInt(month)];
			//get day and week
			for(let i = 1; i <= daySum; i++){
				var delta = i - day;
				var tempWeekIndex = (delta + weekDay + 35) % 7 ? (delta + weekDay + 35) % 7 : 7;
				days.push(tempWeekIndex);
			}
			//push day and week
			let lineCount = 0;
			for(let i = 0; i < daySum; i++){
				var tempWeekIndex = days[i];
				var nowBlock = dateLine[lineCount].getElementsByClassName("dateBlock")[tempWeekIndex - 1];
				nowBlock.childNodes[0].innerText =i + 1;
				if(localStorage["journal_"+(i + 1)]){
					nowBlock.childNodes[1].innerText = localStorage["journal_"+(i + 1)];
				}
				if(i == day - 1){
					nowBlock.getElementsByTagName("span")[0].style.color = "#ddb88c";
					nowBlock.getElementsByTagName("span")[1].style.color = "#ddb88c";
					nowBlock.style.background = "rgba(84, 13, 13, 0.8)";
				}
				if(tempWeekIndex == 7)
					lineCount ++;
			}
		}
		pushDate();
	}

	//update time
	function upDateTime(){
		var date = new Date();
		var hour = date.getHours();
		var minute = date.getMinutes();
		var second = date.getSeconds();
		if(hour < 10){hour = "0" + hour;}
		if(minute < 10){minute = "0" + minute;}
		var times = document.getElementById("time").getElementsByTagName("p");
		times[0].innerText = hour
		times[1].innerText = minute;
		setTimeout(upDateTime, 60 - second);
		//update Day
		if(hour == 0 && upDay == true){
			upDay = false;
			pushDate();
			setTimeout(function(){
				upDay = true;
			},1000*3600*1.01);
		}
	}
	upDateTime();

	//click event
	{
		//change the date block
		var dateBlocks = document.getElementsByClassName("dateBlock");
		for(let i = 0; i < dateBlocks.length; i++){
			dateBlocks[i].onclick = function(e){
				if(e.target.className != "dateBlock"){
					var target = e.target.parentNode;
				}
				else target = e.target;
				var text;
				while(1){
					text = prompt("请输入待办事项");
					if(text.length <= 10){
						break;
					}
					alert("字数最多为10个字");
				}
				if(text.length > 0){
					target.getElementsByTagName("span")[1].innerText = text;
					var dayIndex = target.childNodes[0].innerText;
					localStorage["journal_"+ dayIndex] = text;
				}
			}
		}
		//change the info block
		var info = document.getElementById("info");
		info.onclick = function(e){
			console.log(e);
			var text = prompt("输入想记述的内容");
			var target = e.target;
			if(target.className != "letter"){
				target = target.getElementsByClassName("letter")[0];
			}
			if(text.length > 0)
				target.innerText = text;
		}
	}
		function handleLayout(){
			document.documentElement.style.setProperty('--vw', `${window.innerWidth}px`);
			document.documentElement.style.setProperty('--vh', `${window.innerHeight}px`);
			// 重新计算或刷新任何画布/滚动容器尺寸
			}
			window.addEventListener('resize', handleLayout);
			window.addEventListener('orientationchange', handleLayout);
			handleLayout();

		const scrollCanvas = document.querySelector('.scrollCanvas');
		const time = document.getElementById('time');
		const table = document.getElementById('table');

		scrollCanvas.addEventListener('scroll', () => {
		const scrollLeft = scrollCanvas.scrollLeft;
		const scrollTop = scrollCanvas.scrollTop;
		
		// 补偿滚动偏移
		time.style.transform = `translate(${scrollLeft}px, ${scrollTop}px)`;
		table.style.transform = `translate(${scrollLeft}px, ${scrollTop}px)`;});

</script>
</html>